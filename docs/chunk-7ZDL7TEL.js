import{a as ie}from"./chunk-YSJPQJIY.js";import{a as Be,b as Ae,d as Oe,e as je}from"./chunk-SMIK4ERN.js";import{a as q}from"./chunk-WPQESNG4.js";import{A as Ie,B as te,a as G,r as Ee,s as Ge,t as De,w as Fe,z as ee}from"./chunk-AMFU7SSY.js";import{Aa as $,Ba as Ce,Ca as S,Da as R,Ea as xe,F as he,Fa as b,Ga as C,Ha as a,Ia as r,J as K,Ja as h,La as O,M as l,Na as _,Oa as f,Pa as Se,Q as B,Qa as Pe,R as A,V as M,Va as we,Wa as Te,Xa as Re,Ya as c,Z as k,Za as P,_ as E,_a as w,ba as m,db as W,ea as ue,eb as Me,fa as _e,fb as ke,ga as s,jb as u,la as ye,oa as v,ob as U,pb as Y,q as Q,r as z,rb as T,sa as y,x as J,ya as be,za as g}from"./chunk-LDLCI6JG.js";import{a as Z,b as X}from"./chunk-QEZ3K4DX.js";var ne=class i{_destroyRef=l(M);_count=5;_counter=m(this._count);counter=this._counter.asReadonly();finished=k();constructor(){z(1e3).pipe(G(this._destroyRef)).subscribe(()=>{this._counter.update(t=>t-1),this._counter()===0&&this.finished.emit()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-countdown"]],outputs:{finished:"finished"},decls:5,vars:1,consts:[[1,"d-flex","justify-content-center","align-items-center","vh-100","vw-100","position-fixed","top-0","start-0","text-white","text-center","flex-column"],[1,"fs-3","text-white","text-shadow"],[1,"display-1","fw-bold","text-white","text-outline"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"p",1),c(2,"El juego comienza en:"),r(),a(3,"span",2),c(4),r()()),e&2&&(s(4),P(n.counter()))},encapsulation:2})};var fe=(d=>(d.Countdown="countdown",d.PreRevealAnimation="pre-revel-animation",d.RoleReveal="role-reveal",d.Playing="playing",d.Voting="voting",d.Results="results",d))(fe||{});var oe=class i{controls=E(!0);source=E.required();autoplay=E(!1);muted=E(!1);loop=E(!1);poster=E(null);title=E("");classes=E("");contextmenu=E(!0);videoEnded=k();videoStarted=k();videoReady=k();mutedFn=u(()=>this.autoplay()?!0:this.muted());contextMenuEvent(t){this.contextmenu()||t.preventDefault()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["shared-video"]],inputs:{controls:[1,"controls"],source:[1,"source"],autoplay:[1,"autoplay"],muted:[1,"muted"],loop:[1,"loop"],poster:[1,"poster"],title:[1,"title"],classes:[1,"classes"],contextmenu:[1,"contextmenu"]},outputs:{videoEnded:"videoEnded",videoStarted:"videoStarted",videoReady:"videoReady"},decls:4,vars:9,consts:[[1,"video"],[3,"ended","play","loadedmetadata","contextmenu","ngClass"],["type","video/mp4",3,"src"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"video",1),_("ended",function(){return n.videoEnded.emit()})("play",function(){return n.videoStarted.emit()})("loadedmetadata",function(){return n.videoReady.emit()})("contextmenu",function(p){return n.contextMenuEvent(p)}),h(2,"source",2),c(3," Browser not supported "),r()()),e&2&&(s(),g("ngClass",n.classes()),be("controls",n.controls()?"controls":null)("autoplay",n.autoplay()?"autoplay":null)("muted",n.mutedFn()?"muted":null)("loop",n.loop()?"loop":null)("poster",n.poster()?n.poster():null,ue)("title",n.title()?n.title():null)("aria-label",n.title()?n.title():null),s(),g("src",n.source(),ue))},dependencies:[T,U],styles:[".video[_ngcontent-%COMP%]{overflow:hidden}"]})};var V=i=>i.map(t=>({sort:Math.random(),value:t})).sort((t,e)=>t.sort-e.sort).map(t=>t.value),Ve=(i,t)=>Math.floor(Math.random()*t)+i,ae=i=>V(He(i)),He=i=>Array.from({length:i},(t,e)=>e);var x=class i{_configService=l(Ie);_playerContext=l(q);_roomService=l(te);_socketService=l(ee);_simpsonGameConfiguration;simpsonGameConfiguration=u(()=>this._simpsonGameConfiguration());_gamePlayers=m([]);gamePlayers=this._gamePlayers.asReadonly();_myGamePlayer;myGamePlayer=u(()=>this._myGamePlayer());_actualTurn=m(0);actualTurn=this._actualTurn.asReadonly();_myPlayerPoints=m(0);myPlayerPoints=this._myPlayerPoints.asReadonly();turnPlayer=u(()=>{let t=this.actualTurn();return this.gamePlayers().find(n=>n.turn===t)||null});_actualTurnStep=m("roll_dice");actualTurnStep=this._actualTurnStep.asReadonly();setActualTurnStep(t){this._actualTurnStep.set(t)}isMyTurn=u(()=>this.actualTurn()===this.myGamePlayer().turn);nextTurn(){this._actualTurn.update(t=>this.gamePlayers().length===t+1?0:t+1),this.setActualTurnStep("roll_dice")}constructor(){this.initialize(),this.events()}initialize(){this._simpsonGameConfiguration=m(this._configService.config().features.simpsons)}initPlayers(){this.emitEventIfIAmLeader("init-players",this.getAssignedRoles())}getAssignedRoles(){let t=this._roomService.room();if(!t)return{};let e=this.simpsonGameConfiguration();if(!e)return{};let n=Object.entries(e.roles),o=t.players.length,p=V(n.sort((I,N)=>I[1].priority-N[1].priority).splice(0,o).map(I=>I[0])),d=V([...e.board.player_colors]),F=ae(o),L={};return t.players.forEach((I,N)=>{L[I.nickname]={rol:p[N],color:d[N],turn:F[N]}}),L}updateGamePlayerByNickname(t,e){return this._gamePlayers.update(n=>n.map(o=>o.player.nickname===t?e:o)),e}getRandomNumber(t,e){return Math.floor(Math.random()*e)+t}emitEvent(t,e){let n=this._roomService.room();n&&this._socketService.emit("game-event",X(Z({},this._playerContext.playerContext()),{event:t,data:e,room:n.name}))}emitEventIfIAmLeader(t,e){this._roomService.iAmLeader()&&this.emitEvent(t,e)}initGamePlayers(t){let e=[],n=this._roomService.room();if(!n)return;let o=this.simpsonGameConfiguration();o&&(n.players.map(p=>{let d=t[p.nickname],F={player:p,color:d.color,turn:d.turn,rol:{name:d.rol,data:o.roles[d.rol]},board:{position:0}};this._playerContext.nickname()===p.nickname&&(this._myGamePlayer=m(F)),e.push(F)}),this._gamePlayers.set(e.sort((p,d)=>p.turn-d.turn)),console.log(e))}events(){this.gameEvents({"init-players":t=>{let e=t.data;this.initGamePlayers(e)},"next-turn":t=>{this._actualTurn.update(e=>this.gamePlayers().length===e+1?0:e++)}})}gameEvents(t,e=[]){this._socketService.specificEvents("game-event",t,e)}gameFinished(){this._roomService.iAmLeader()&&(this._myPlayerPoints.set(0),this._actualTurnStep.set("roll_dice"),this._roomService.updateGameStarted(this._roomService.room()?.name||"",!1).pipe(J(1),he(()=>this._playerContext.emitGameFinished(this._roomService.room()?.name||""))).subscribe())}static \u0275fac=function(e){return new(e||i)};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ze(i,t){if(i&1&&(a(0,"li",8)(1,"strong"),c(2),r(),c(3),r()),i&2){let e=t.$implicit;s(2),P(e.name),s(),w(": ",e.description," ")}}var se=class i{_destroyRef=l(M);_gameService=l(x);rol=u(()=>this._gameService.myGamePlayer().rol.data);finished=k();constructor(){Q(1e3).pipe(G(this._destroyRef)).subscribe(()=>{this.finished.emit()})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-role-reveal"]],outputs:{finished:"finished"},decls:14,vars:1,consts:[[1,"d-flex","justify-content-center","align-items-center","container-rol-reveal","w-100","h-100"],[1,"card","bg-dark","text-white","shadow-lg","p-4","rounded-4",2,"max-width","600px","width","80%"],[1,"h3","mb-3"],[1,"row"],[1,"col-12","col-sm-6"],[1,"mb-4"],[1,"mb-3"],[1,"list-unstyled"],[1,"mb-2"],["url","static/img/fatTony.png",1,"card-img-top"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),c(3),r(),a(4,"div",3)(5,"div",4)(6,"div",5)(7,"h4",6),c(8,"Habilidades:"),r(),a(9,"ul",7),b(10,Ze,4,2,"li",8,R),r()()(),a(12,"div",4),h(13,"shared-image",9),r()()()()),e&2&&(s(3),P(n.rol().name),s(7),C(n.rol().specialAbilities))},dependencies:[ie],styles:[".container-rol-reveal[_ngcontent-%COMP%]{background:linear-gradient(45deg,#ff6f61,#f7b7a3,#f9d423,#ff4e50);background-size:400% 400%;animation:_ngcontent-%COMP%_gradientAnimation 15s ease infinite}@keyframes _ngcontent-%COMP%_gradientAnimation{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}"]})};var Xe=i=>({transform:i});function Qe(i,t){if(i&1&&(a(0,"div",3),c(1),r()),i&2){let e=t.$implicit,n=t.$index,o=f();$("cursor-pointer",o.enabledDice())("highlighted",o.enabledDice()),g("ngClass",e),s(),w(" ",n+1," ")}}var le=class i{_destroyRef=l(M);_socketService=l(ee);_gameService=l(x);_diceStyleTransform=m("none");diceStyleTransform=this._diceStyleTransform.asReadonly();finished=k();_current=m({x:0,y:0});points=["front","back","right","left","top","bottom"];_counter=0;isMyTurn=u(()=>this._gameService.isMyTurn());enabledDice=u(()=>this.enabled()&&this.isMyTurn()&&this._gameService.actualTurnStep()==="roll_dice");_enabled=m(!0);enabled=this._enabled.asReadonly();ngOnInit(){this.initialize()}initialize(){this.events()}diceClick(){this._enabled.set(!1),this._gameService.emitEvent("roll-dice",{shuffledDiceValues:ae(6)})}events(){this._gameService.gameEvents({"roll-dice":t=>{this.throwDice(t.data.shuffledDiceValues),this._gameService.setActualTurnStep("processing_dice"),this._enabled.set(!0)}})}throwDice(t){let e=[{x:0,y:0},{x:0,y:180},{x:0,y:-90},{x:0,y:90},{x:-90,y:0},{x:90,y:0}];z(400).pipe(J(6),G(this._destroyRef)).subscribe(()=>{let n=t[this._counter]+1,o=e[n-1];this._current.set(o),this._diceStyleTransform.set(`rotateX(${o.x}deg) rotateY(${o.y}deg)`),this._counter++,this._counter===6&&(this._counter=0,this.finished.emit(n))})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-dice"]],outputs:{finished:"finished"},decls:4,vars:3,consts:[[1,"scene","position-relative"],[1,"cube","cube-block",3,"click","ngStyle"],[1,"face","border-5","border-dark-subtle","d-flex","flex-column","prevent-select",3,"cursor-pointer","highlighted","ngClass"],[1,"face","border-5","border-dark-subtle","d-flex","flex-column","prevent-select",3,"ngClass"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),_("click",function(){return n.enabledDice()&&n.diceClick()}),b(2,Qe,2,6,"div",2,R),r()()),e&2&&(s(),g("ngStyle",W(1,Xe,n.diceStyleTransform())),s(),C(n.points))},dependencies:[T,U,Y],styles:[".scene[_ngcontent-%COMP%]{width:100px;height:100px;perspective:1000px}.cube[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;transform-style:preserve-3d;transform:rotateX(0) rotateY(0);transition:transform .4s ease}.face[_ngcontent-%COMP%]{position:absolute;width:100px;height:100px;background:#fff;border:2px solid;border-radius:10px;display:flex;justify-content:center;align-items:center;color:#000;font-size:2rem;font-weight:700}.highlighted[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_highlightedAnimation;animation-duration:1.5s;animation-iteration-count:infinite}@keyframes _ngcontent-%COMP%_highlightedAnimation{0%{background-color:#fff}50%{background-color:#6d6b6b}to{background-color:#fff}}.front[_ngcontent-%COMP%]{transform:rotateY(0) translateZ(50px)}.back[_ngcontent-%COMP%]{transform:rotateY(180deg) translateZ(50px)}.right[_ngcontent-%COMP%]{transform:rotateY(90deg) translateZ(50px)}.left[_ngcontent-%COMP%]{transform:rotateY(-90deg) translateZ(50px)}.top[_ngcontent-%COMP%]{transform:rotateX(90deg) translateZ(50px)}.bottom[_ngcontent-%COMP%]{transform:rotateX(-90deg) translateZ(50px)}"]})};var Je=["*"],Ke=i=>({color:i});function et(i,t){i&1&&(a(0,"em",11),c(1,"(T\xFA)"),r())}function tt(i,t){i&1&&h(0,"i",12)}function it(i,t){if(i&1&&(a(0,"div",7)(1,"div",8)(2,"span",9),c(3),r(),a(4,"span",10),c(5),r(),y(6,et,2,0,"em",11),r(),y(7,tt,1,0,"i",12),r()),i&2){let e=t.$implicit,n=f();$("border-secondary",n.gamePlayerOnTurn(e)),s(),g("ngStyle",W(7,Ke,e.color)),s(2),w(" ",e.turn+1," "),s(2),P(e.player.nickname),s(),S(e.player.nickname===n.myGamePlayer().player.nickname?6:-1),s(),S(n.gamePlayerOnTurn(e)?7:-1)}}var me=class i{_gameService=l(x);gamePlayers=u(()=>this._gameService.gamePlayers());myGamePlayer=u(()=>this._gameService.myGamePlayer());turnMessage=u(()=>{let t=this.turnPlayer();if(t)return this._gameService.isMyTurn()?"Tu turno":`Turno de ${t.player.nickname}`});turnPlayer=u(()=>this._gameService.turnPlayer());gamePlayerOnTurn(t){return this.turnPlayer()?.player.nickname===t.player.nickname}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-players-list"]],ngContentSelectors:Je,decls:11,vars:2,consts:[[1,"card","border","shadow-sm"],[1,"card-header","bg-primary","text-secondary"],[1,"fw-semibold","d-flex","align-items-center","mb-1"],[1,"bi","bi-people-fill","me-2","fw-bold"],[1,"fw-semibold","text-info","fst-italic"],[1,"list-group","list-group-flush"],[1,"list-group-item","border-secondary","border-1","d-flex","align-items-center",3,"border-secondary"],[1,"list-group-item","border-secondary","border-1","d-flex","align-items-center"],[1,"d-flex","align-items-center","fw-bold",3,"ngStyle"],[1,"me-2","d-inline-flex","justify-content-center","align-items-center","border","rounded",2,"width","1.8rem","height","1.8rem"],[1,"me-1"],[1,"text-muted"],[1,"bi","bi-dice-2","fs-4","text-white","ms-auto"]],template:function(e,n){e&1&&(Se(),a(0,"div",0)(1,"div",1)(2,"div",2),h(3,"i",3),c(4),r(),a(5,"div",4),c(6),r()(),Pe(7),a(8,"div",5),b(9,it,8,9,"div",6,R),r()()),e&2&&(s(4),w("Jugadores (",n.gamePlayers().length,") "),s(2),w(" ",n.turnMessage()," "),s(3),C(n.gamePlayers()))},dependencies:[T,Y],encapsulation:2})};var Ne=(i,t)=>{let e=[],o=i/3.5;return t.forEach(p=>{let d=p.board.position,{turn:F}=p,L=Math.floor(d/5),I=d%5,ze=L%2===0?I:4-I,$e=L*i,We=ze*i,ve=3,Ue=F%ve,Ye=Math.floor(F/ve),qe={top:$e+o*Ye+o/5,left:We+o*Ue+o/5};e.push({color:p.color,size:o,position:qe})}),e};var H=class i{_toasts=m([]);toasts=this._toasts.asReadonly();show(t){this._toasts.update(e=>[...e,t])}remove(t){this._toasts.update(e=>e.filter(n=>n!==t))}clear(){this._toasts.set([])}static \u0275fac=function(e){return new(e||i)};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};function nt(i,t){if(i&1&&h(0,"i",2),i&2){let e=f().$implicit;g("ngClass","bi bi-"+e.icon)}}function ot(i,t){if(i&1){let e=O();a(0,"ngb-toast",1),_("hidden",function(){let o=B(e).$implicit,p=f();return A(p.remove(o))}),y(1,nt,1,1,"i",2),a(2,"span"),c(3),r()()}if(i&2){let e=t.$implicit,n=f();Ce(n.getClasses(e)),g("autohide",!0)("delay",e.delay||5e3),s(),S(e.icon?1:-1),s(2),P(e.message)}}var ce=class i{_toastService=l(H);toasts=u(()=>this._toastService.toasts());remove(t){this._toastService.remove(t)}getClasses(t){return`bg-${t.type.bg} text-${t.type.text}`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["shared-toast"]],hostAttrs:[1,"toast-container","position-fixed","top-0","end-0","p-3",2,"z-index","1200"],decls:2,vars:0,consts:[[3,"class","autohide","delay"],[3,"hidden","autohide","delay"],[3,"ngClass"]],template:function(e,n){e&1&&b(0,ot,4,6,"ngb-toast",0,xe),e&2&&C(n.toasts())},dependencies:[T,U,De,Ge],encapsulation:2})};var rt=i=>({afterFormTemplate:i});function at(i,t){if(i&1&&c(0),i&2){let e=f(2);w(" ",e.spaceReplacer," ")}}function st(i,t){if(i&1&&(a(0,"div",9)(1,"div",10)(2,"div",11),y(3,at,1,1),r(),a(4,"div",12),c(5),r()()()),i&2){let e=t.$implicit,n=t.$index,o=f();$("active",o.indexActiveLetter()===n)("ms-2",n!==0),s(3),S(e===o.spaceReplacer?3:-1),s(2),w("",e," ")}}function lt(i,t){if(i&1&&(a(0,"div",13)(1,"div",15),c(2),r()()),i&2){let e=f().$implicit;s(2),w(" ",e.message," ")}}function mt(i,t){i&1&&c(0," ********* ")}function ct(i,t){if(i&1&&c(0),i&2){let e=f(2).$implicit;w(" ",e.message," ")}}function pt(i,t){if(i&1&&(a(0,"div",14)(1,"div",16)(2,"div",17),c(3),r(),y(4,mt,1,0)(5,ct,1,1),r()()),i&2){let e=f().$implicit;s(3),P(e.nickname),s(),S(e.isCorrect?4:5)}}function dt(i,t){if(i&1&&y(0,lt,3,1,"div",13)(1,pt,6,2,"div",14),i&2){let e=t.$implicit;S(e.isMine?0:1)}}function ut(i,t){if(i&1&&h(0,"lib-grcm-button",18),i&2){let e=f();g("disabled",e.win())}}var pe=class i{_destroyRef=l(M);_playerContext=l(q);_toastService=l(H);_activeModal=l(Ee);_gameService=l(x);data=m(null);_word=m([]);word=this._word.asReadonly();spaceReplacer="_";_indexActiveLetter=m(-1);indexActiveLetter=this._indexActiveLetter.asReadonly();_messagesSecretLetter=m([]);messagesSecretLetter=this._messagesSecretLetter.asReadonly();_win=m(!1);win=this._win.asReadonly();_counterWins=m(0);gameName="Letra secreta";_extraSeconds=3;_form=null;ngOnInit(){this.initialize()}dataForm={form:{id:"secret-letter",classes:"d-flex"},controls:{message:{component:je,formFieldComponent:Oe,value:"",validators:[],args:{control:{placeholder:"Escriba aqu\xED la palabra",autocomplete:!1,additionalClasses:"me-2"},formField:{}},classes:{control:"input-group"}}}};submit(t){this._form=t.form;let e=this._form.value.message;this.clearForm(),this._gameService.emitEvent("message",{message:e,nickname:this._playerContext.nickname()})}clearForm(t=!1){let e=this._form?.controls.message;t&&e?.disable(),e?.setValue("")}initialize(){if(this.events(),!this._gameService.isMyTurn())return;let t=this._gameService.simpsonGameConfiguration().board.challenges.letterSecretGame,n=t[Ve(0,t.length-1)].replaceAll(" ",this.spaceReplacer).split(""),o=[];n.forEach((F,L)=>{F!==this.spaceReplacer&&o.push(L)});let p=[...V([...o]),...V([...o]),...V([...o])],d={word:n,activeIndexsLetters:p};this._gameService.emitEvent("secret-letter-data",d)}challengeFinish(){this.nextTurn()}nextTurn(){this._gameService.emitEvent("challenge-finished")}events(){this._gameService.gameEvents({"challenge-finished":t=>{this._activeModal.close("Close click"),this._gameService.nextTurn()},"secret-letter-data":t=>{this.startSecretLetterGame(t.data)},message:t=>{let e=this.clearWord(this.word().join("")),n=t.data.message,o=e.includes(this.clearWord(n)),p=this._playerContext.nickname()===t.data.nickname;o&&(this._toastService.show({message:p?"Acertaste!":`${t.data.nickname} acert\xF3 la palabra!`,type:{bg:p?"success":"danger",text:"white"}}),this._counterWins.update(d=>d+1)),p&&o&&(this.clearForm(!0),this._win.set(!0)),this._messagesSecretLetter.update(d=>[...d,{message:n,isCorrect:o,nickname:t.data.nickname,isMine:t.isMine}])}})}startSecretLetterGame({word:t,activeIndexsLetters:e}){let n=0;this._word.set(t),z(2e3).pipe(G(this._destroyRef)).subscribe(()=>{if(n>=e.length||this._gameService.gamePlayers().length===this._counterWins()){this._extraSeconds===0?this.challengeFinish():this._extraSeconds--;return}this._indexActiveLetter.set(e[n]),n++})}clearWord(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replaceAll(" ","").replaceAll(this.spaceReplacer,"").replace(/[^a-z0-9]/g,"")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-challenge-modal"]],decls:17,vars:6,consts:[["afterFormTemplate",""],[1,"modal-header","bg-primary","text-white"],[1,"modal-title","text-secondary"],[1,"modal-body","text-center"],[1,"mt-3","fw-bold","fs-4","text-secondary"],[1,"d-flex","flex-wrap","justify-content-center","align-items-center","w-100"],[1,"flip-card","mt-2",3,"active","ms-2"],[1,"mt-4","mb-3","border","rounded","p-3",2,"min-height","300px","max-height","300px","overflow-y","auto"],[3,"formSubmit","data","templates"],[1,"flip-card","mt-2"],[1,"flip-card-inner","position-relative","text-center",2,"width","35px","height","35px"],[1,"flip-card-front","bg-white","fs-4","rounded","fw-bold","text-dark","w-100","h-100","position-absolute"],[1,"flip-card-back","bg-white","fs-4","rounded","fw-bold","text-dark","w-100","h-100","position-absolute"],[1,"d-flex","justify-content-end","mb-2","text-end"],[1,"d-flex","justify-content-start","mb-2","text-start"],[1,"bg-primary","fw-bold","text-dark","p-2","rounded","shadow-sm"],[1,"bg-white","fw-bold","text-secondary","p-2","rounded","shadow-sm"],[1,"small","text-dark"],["type","submit","icon","send-fill",3,"disabled"]],template:function(e,n){if(e&1){let o=O();a(0,"div",1)(1,"h4",2),c(2),r()(),h(3,"shared-toast"),a(4,"div",3)(5,"p",4),c(6),r(),a(7,"div",5),b(8,st,6,6,"div",6,R),r(),a(10,"div")(11,"div",7),b(12,dt,2,1,null,null,R),r(),a(14,"lib-grcm-form",8),_("formSubmit",function(d){return B(o),A(n.submit(d))}),y(15,ut,1,1,"ng-template",null,0,ke),r()()()}if(e&2){let o=Re(16);s(2),P(n.gameName),s(4),P(n.data()),s(2),C(n.word()),s(4),C(n.messagesSecretLetter()),s(2),g("data",n.dataForm)("templates",W(4,rt,o))}},dependencies:[Ae,Be,ce],styles:[".flip-card[_ngcontent-%COMP%]{width:35px;height:35px;perspective:1000px;transition:.3s}.flip-card-inner[_ngcontent-%COMP%]{transition:transform .6s;transform-style:preserve-3d;box-shadow:0 4px 8px #0003}.flip-card.active[_ngcontent-%COMP%]   .flip-card-inner[_ngcontent-%COMP%]{transform:rotateY(180deg);box-shadow:0 8px 16px #0003}.flip-card-front[_ngcontent-%COMP%], .flip-card-back[_ngcontent-%COMP%]{-webkit-backface-visibility:hidden;backface-visibility:hidden}.flip-card-back[_ngcontent-%COMP%]{transform:rotateY(180deg)}"]})};var ft=["boardPiece"],gt=(i,t,e,n,o)=>({"background-color":i,top:t,left:e,width:n,height:o}),vt=(i,t)=>t.color;function ht(i,t){if(i&1&&h(0,"div",10),i&2){let e=t.$implicit;g("ngStyle",Me(1,gt,e.color,e.position.top+"px",e.position.left+"px",e.size+"px",e.size+"px"))}}function _t(i,t){if(i&1&&h(0,"shared-image",13),i&2){let e=f().$implicit;g("url","static/img/board/"+e+".png")}}function yt(i,t){if(i&1&&(a(0,"div",11,0)(2,"div",12),y(3,_t,1,1,"shared-image",13),r()()),i&2){let e=t.$implicit;s(3),S(e?3:-1)}}var de=class i{_destroyRef=l(M);_gameService=l(x);_modalService=l(Fe);rol=u(()=>this._gameService.myGamePlayer().rol.data);_board=m([]);board=this._board.asReadonly();_renderBoard=m([]);renderBoard=this._renderBoard.asReadonly();simpsonsBoard=m(this._gameService.simpsonGameConfiguration().board);isMyTurn=u(()=>this._gameService.isMyTurn());boardPiecesRef=ye("boardPiece");_boardPieceSize=m(0);playersBoardPieces=u(()=>Ne(this._boardPieceSize(),this._gameService.gamePlayers()));ngAfterViewInit(){this.setBoardPieceSize()}onResize(){this.setBoardPieceSize()}setBoardPieceSize(){let t=this.boardPiecesRef()?.nativeElement;t&&this._boardPieceSize.set(t.offsetWidth)}ngOnInit(){this.initialize()}initialize(){this.initBoard(),this._gameService.gameEvents({"challenge-step":t=>{this._gameService.setActualTurnStep("challenge"),Q(2500).pipe(G(this._destroyRef)).subscribe(()=>{let e=this._gameService.turnPlayer();if(e&&e?.board.position>=this.board().length){this._gameService.gameFinished();return}this._modalService.open({component:pe,args:{data:t.data.squareType},options:{backdrop:"static",keyboard:!1,modalDialogClass:"modal-fullscreen"}})})}})}initBoard(){this._board.set(this.simpsonsBoard().squares);let t=this.board(),e=[],n=!0;for(let o=0;o<t.length;o+=5)console.log(t.slice(o,5)),n&&e.push(...t.slice(o,o+5)),n||e.push(...t.slice(o,o+5).reverse()),n=!n;this._renderBoard.set(e)}rollDiceFinish(t){let e=this._gameService.turnPlayer();if(!e)return;let n=this._gameService.isMyTurn(),o=this._gameService.updateGamePlayerByNickname(e.player.nickname,X(Z({},e),{board:{position:e.board.position+t}})),p=this.board()[o.board.position];p==="dice"?this._gameService.setActualTurnStep("roll_dice"):n&&this._gameService.emitEvent("challenge-step",{squareType:p})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-board"]],viewQuery:function(e,n){e&1&&we(n.boardPiecesRef,ft,5),e&2&&Te()},hostBindings:function(e,n){e&1&&_("resize",function(){return n.onResize()},!1,_e)},decls:14,vars:0,consts:[["boardPiece",""],[1,"row","w-100","p-4","m-0"],[1,"col-12","col-lg-3","mb-4"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[1,"w-100"],[1,"d-flex","justify-content-center","mt-3","mb-3"],[3,"finished"],[1,"col-12","col-lg-9"],[1,"container","p-0",2,"max-width","600px"],[1,"position-relative","row","row-cols-5","g-2"],[1,"boardPiece","border","border-3","position-absolute","z-2","rounded-circle",3,"ngStyle"],[1,"col"],[1,"position-relative","ratio","ratio-1x1","bg-secondary","border","border-dark","d-flex","align-items-start","justify-content-start","p-1"],[1,"position-absolute",3,"url"]],template:function(e,n){e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"simpsons-players-list")(5,"div",5)(6,"simpsons-dice",6),_("finished",function(p){return n.rollDiceFinish(p)}),r()()()()()(),a(7,"div",7)(8,"div",8)(9,"div",9),b(10,ht,1,7,"div",10,vt),b(12,yt,4,1,"div",11,R),r()()()()),e&2&&(s(10),C(n.playersBoardPieces()),s(2),C(n.renderBoard()))},dependencies:[T,Y,le,ie,me],styles:[".boardPiece[_ngcontent-%COMP%]{transition:top 2s,left 2s}"]})};function bt(i,t){if(i&1){let e=O();a(0,"simpsons-countdown",1),_("finished",function(){B(e);let o=f();return A(o.countdownFinished())}),r()}}function Ct(i,t){if(i&1){let e=O();a(0,"shared-video",2),_("videoEnded",function(){B(e);let o=f();return A(o.preRevelAnimationEnded())}),r()}i&2&&g("autoplay",!0)("contextmenu",!1)("loop",!1)("controls",!1)}function xt(i,t){if(i&1){let e=O();a(0,"simpsons-role-reveal",1),_("finished",function(){B(e);let o=f();return A(o.roleRevealFinished())}),r()}}function St(i,t){i&1&&h(0,"simpsons-board")}var ge=class i{_playerContext=l(q);_roomService=l(te);_gameService=l(x);_gameState=m("countdown");gameState=this._gameState.asReadonly();GameState=fe;constructor(){}ngOnInit(){this.initialize()}initialize(){this._gameService.initPlayers()}countdownFinished(){this._gameState.set("playing")}preRevelAnimationEnded(){this._gameState.set("role-reveal")}roleRevealFinished(){this._gameState.set("playing")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["simpsons-game-page"]],decls:4,vars:1,consts:[["classes","centered-absolute mw-100 h-100","source","static/video/animationRol.mp4",3,"autoplay","contextmenu","loop","controls"],[3,"finished"],["classes","centered-absolute mw-100 h-100","source","static/video/animationRol.mp4",3,"videoEnded","autoplay","contextmenu","loop","controls"]],template:function(e,n){if(e&1&&y(0,bt,1,0,"simpsons-countdown")(1,Ct,1,4,"shared-video",0)(2,xt,1,0,"simpsons-role-reveal")(3,St,1,0,"simpsons-board"),e&2){let o;S((o=n.gameState())===n.GameState.Countdown?0:o===n.GameState.PreRevealAnimation?1:o===n.GameState.RoleReveal?2:o===n.GameState.Playing?3:-1)}},dependencies:[T,ne,oe,se,de],encapsulation:2})};export{ge as default};
